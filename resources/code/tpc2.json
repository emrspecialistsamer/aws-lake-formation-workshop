{
  "Description": "CloudFormation template for creating an Lake Formation workshop resources",
  "Mappings": {
    "SubnetConfig": {
      "VPC": {
        "CIDR": "10.0.0.0/16"
      },
      "PublicOne": {
        "CIDR": "10.0.0.0/24"
      },
      "PublicTwo": {
        "CIDR": "10.0.1.0/24"
      },
      "Private": {
        "CIDR": "10.0.2.0/24"
      }
    }
  },
  "Parameters": {
    "DBMasterUser": {
      "Type": "String",
      "Default": "admin",
      "Description": "Master username for TPC database."
    },
    "DBMasterPassword": {
      "Type": "String",
      "Default": "BigData26!",
      "Description": "Master password for TPC database."
    },
    "SampleUserPassword": {
      "Type": "String",
      "Default": "Password1!",
      "Description": "Password for all test users."
    }
  },
  "Resources": {
    "BackUpRestoreInstance": {
      "Type": "AWS::EC2::Instance",
      "Properties": {
        "InstanceType": "t2.small",
        "KeyName": "dev-virginia",
        "ImageId": "ami-0c6b1d09930fac512",
        "IamInstanceProfile": "arn:aws:iam::145744019422:instance-profile/sad-ListS3BucketsInstanceProfile-9KVG8OQSDVX7",
        "NetworkInterfaces": [
          {
            "AssociatePublicIpAddress": "true",
            "DeviceIndex": "0",
            "GroupSet": [
              "sg-0ec173bff86832e2a"
            ],
            "SubnetId": "subnet-000ea5670bd5714ee"
          }
        ],
        "UserData": {
          "Fn::Base64": {
            "Fn::Join": [
              "",
              [
                "#!/bin/bash -ex\n",
                "sudo yum -y install mysql\n",
                "aws s3 cp s3://aws-data-analytics-blog/lake-formation-workshop/sampledata/tpc.backup . --debug\n",
                "gunzip < tpc.backup | mysql -h tpc-database1.cgvk0abmo9rn.us-east-1.rds.amazonaws.com",
                " -u ",{ "Ref": "DBMasterUser"}," -p'",{ "Ref": "DBMasterPassword"},"' tpc",
                "\n"
              ]
            ]
          }
        },
        "Tags" : [ {
          "Key" : "Name",
          "Value" : "EC2-DB-Loader"
        } ]
      },
      "DependsOn": [
        "TPCDatabase"
      ]
    }
  }
}
